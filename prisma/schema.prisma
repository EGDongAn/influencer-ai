// Prisma schema for Influencer Marketing Management System
// Hospital influencer collaboration platform

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["influencer"]
}

// 모든 모델은 influencer 스키마에 생성됨

// ============================================
// 인플루언서 (Influencer)
// ============================================
model Influencer {
  id              String   @id @default(cuid())
  name            String
  nickname        String?  // 활동명
  email           String?
  phone           String?
  profileImageUrl String?

  // 티어 및 카테고리
  tier            InfluencerTier @default(SILVER)
  category        String[]       // 뷰티, 건강, 라이프스타일 등

  // 채널 정보
  channels        Channel[]

  // 메모 및 특이사항
  notes           String?

  // 협업 이력
  collaborations  Collaboration[]

  // 상태
  isActive        Boolean  @default(true)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([tier])
  @@index([isActive])
  @@index([createdAt])
  @@map("influencers")
  @@schema("influencer")
}

enum InfluencerTier {
  VIP
  GOLD
  SILVER
  BRONZE

  @@schema("influencer")
}

// ============================================
// 채널 (Channel) - 인플루언서의 SNS 채널
// ============================================
model Channel {
  id            String      @id @default(cuid())
  influencerId  String
  influencer    Influencer  @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  platform      Platform
  handle        String      // @username 또는 채널명
  url           String?
  followerCount Int?

  // 콘텐츠 링크
  contents      Content[]

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([influencerId])
  @@index([platform])
  @@map("channels")
  @@schema("influencer")
}

enum Platform {
  YOUTUBE
  INSTAGRAM
  TIKTOK
  BLOG_NAVER
  BLOG_OTHER
  FACEBOOK
  TWITTER
  OTHER

  @@schema("influencer")
}

// ============================================
// 캠페인 (Campaign)
// ============================================
model Campaign {
  id              String          @id @default(cuid())
  name            String
  description     String?

  // 병원/클라이언트 정보
  clientName      String          // 병원명
  clientContact   String?         // 담당자 연락처

  // 캠페인 기간
  startDate       DateTime
  endDate         DateTime?

  // 캠페인 유형
  type            CampaignType    @default(COLLABORATION)

  // 예산
  budget          Decimal?        @db.Decimal(12, 0)

  // 상태
  status          CampaignStatus  @default(PLANNING)

  // 협업 목록
  collaborations  Collaboration[]

  // 메모
  notes           String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([status])
  @@index([type])
  @@index([startDate])
  @@index([clientName])
  @@map("campaigns")
  @@schema("influencer")
}

enum CampaignType {
  COLLABORATION   // 협찬
  ADVERTISEMENT   // 광고
  EVENT           // 이벤트
  REVIEW          // 리뷰
  OTHER

  @@schema("influencer")
}

enum CampaignStatus {
  PLANNING        // 기획 중
  IN_PROGRESS     // 진행 중
  COMPLETED       // 완료
  CANCELLED       // 취소됨

  @@schema("influencer")
}

// ============================================
// 협업 (Collaboration) - 캠페인과 인플루언서 연결
// ============================================
model Collaboration {
  id              String              @id @default(cuid())

  campaignId      String
  campaign        Campaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  influencerId    String
  influencer      Influencer          @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  // 협업 조건
  fee             Decimal?            @db.Decimal(12, 0)  // 협찬비
  feeType         FeeType             @default(FIXED)

  // 일정 (다중 스케줄 지원)
  schedules       Schedule[]

  // 진행 상태 (칸반 보드용)
  status          CollaborationStatus @default(CONTACTED)

  // 콘텐츠
  contents        Content[]

  // 메모
  notes           String?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@unique([campaignId, influencerId])
  @@index([campaignId])
  @@index([influencerId])
  @@index([status])
  @@map("collaborations")
  @@schema("influencer")
}

enum FeeType {
  FIXED           // 고정 금액
  PER_CONTENT     // 콘텐츠당
  REVENUE_SHARE   // 수익 분배
  BARTER          // 물물교환(시술 제공)

  @@schema("influencer")
}

enum CollaborationStatus {
  CONTACTED       // 컨택 완료
  NEGOTIATING     // 협의 중
  CONFIRMED       // 확정
  SHOOTING_DONE   // 촬영 완료
  PROGRESS_DONE   // 경과사진 완료
  UPLOADED        // 업로드 완료
  COMPLETED       // 협업 완료
  CANCELLED       // 취소됨

  @@schema("influencer")
}

// ============================================
// 스케줄 (Schedule) - 협업 일정 관리
// ============================================
model Schedule {
  id              String         @id @default(cuid())

  collaborationId String
  collaboration   Collaboration  @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  // 일정 유형
  type            ScheduleType
  title           String?        // 일정 제목 (선택)

  // 일정 시간
  scheduledDate   DateTime       // 예정일
  scheduledTime   String?        // 예정 시간 (HH:mm 형식)

  // 상태
  status          ScheduleStatus @default(SCHEDULED)
  completedAt     DateTime?      // 완료일

  // 메모
  notes           String?

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([collaborationId])
  @@index([type])
  @@index([scheduledDate])
  @@index([status])
  @@map("schedules")
  @@schema("influencer")
}

enum ScheduleType {
  SHOOTING        // 촬영
  PROGRESS        // 경과 사진
  UPLOAD          // 업로드
  MEETING         // 미팅
  REVIEW          // 검토
  OTHER           // 기타

  @@schema("influencer")
}

enum ScheduleStatus {
  SCHEDULED       // 예정됨
  CONFIRMED       // 확정됨
  IN_PROGRESS     // 진행 중
  COMPLETED       // 완료
  CANCELLED       // 취소
  RESCHEDULED     // 일정 변경

  @@schema("influencer")
}

// ============================================
// 콘텐츠 (Content) - 업로드된 콘텐츠
// ============================================
model Content {
  id              String        @id @default(cuid())

  collaborationId String
  collaboration   Collaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  channelId       String
  channel         Channel       @relation(fields: [channelId], references: [id], onDelete: Cascade)

  // 콘텐츠 정보
  title           String?
  url             String
  contentType     ContentType   @default(VIDEO)

  // 업로드 정보
  uploadedAt      DateTime?

  // 성과 지표
  views           Int           @default(0)
  likes           Int           @default(0)
  comments        Int           @default(0)
  shares          Int           @default(0)

  // 성과 업데이트 시간
  metricsUpdatedAt DateTime?

  // 메모
  notes           String?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([collaborationId])
  @@index([channelId])
  @@index([contentType])
  @@index([uploadedAt])
  @@map("contents")
  @@schema("influencer")
}

enum ContentType {
  VIDEO           // 영상
  SHORTS          // 숏폼 (릴스, 쇼츠, 틱톡)
  IMAGE           // 이미지 포스트
  BLOG            // 블로그 글
  STORY           // 스토리
  OTHER

  @@schema("influencer")
}
