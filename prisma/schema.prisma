generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["influencer"]
}

model Influencer {
  id              String          @id @default(cuid())
  name            String
  nickname        String?
  email           String?
  phone           String?
  profileImageUrl String?
  tier            InfluencerTier  @default(SILVER)
  category        String[]
  notes           String?
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  channels        Channel[]
  collaborations  Collaboration[]

  @@index([tier])
  @@index([isActive])
  @@index([createdAt])
  @@map("influencers")
  @@schema("influencer")
}

model Channel {
  id            String     @id @default(cuid())
  influencerId  String
  platform      Platform
  handle        String
  url           String?
  followerCount Int?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  influencer    Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  contents      Content[]

  @@index([influencerId])
  @@index([platform])
  @@map("channels")
  @@schema("influencer")
}

model Campaign {
  id             String          @id @default(cuid())
  name           String
  description    String?
  clientName     String
  clientContact  String?
  startDate      DateTime
  endDate        DateTime?
  type           CampaignType    @default(COLLABORATION)
  budget         Decimal?        @db.Decimal(12, 0)
  status         CampaignStatus  @default(PLANNING)
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  collaborations Collaboration[]

  @@index([status])
  @@index([type])
  @@index([startDate])
  @@index([clientName])
  @@map("campaigns")
  @@schema("influencer")
}

model Collaboration {
  id             String                   @id @default(cuid())
  campaignId     String
  influencerId   String
  fee            Decimal?                 @db.Decimal(12, 0)
  feeType        FeeType                  @default(FIXED)
  status         CollaborationStatus      @default(CONTACTED)
  notes          String?
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  progressRounds Int                      @default(2)
  shootingRounds Int                      @default(1)
  treatments     CollaborationTreatment[]
  campaign       Campaign                 @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  influencer     Influencer               @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  contents       Content[]
  schedules      Schedule[]

  @@unique([campaignId, influencerId])
  @@index([campaignId])
  @@index([influencerId])
  @@index([status])
  @@map("collaborations")
  @@schema("influencer")
}

model Schedule {
  id              String         @id @default(cuid())
  collaborationId String
  type            ScheduleType
  title           String?
  scheduledDate   DateTime
  scheduledTime   String?
  status          ScheduleStatus @default(SCHEDULED)
  completedAt     DateTime?
  notes           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  originalDate    DateTime?
  roundNumber     Int?
  totalRounds     Int?
  collaboration   Collaboration  @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  @@index([collaborationId])
  @@index([type])
  @@index([scheduledDate])
  @@index([status])
  @@map("schedules")
  @@schema("influencer")
}

model Content {
  id               String        @id @default(cuid())
  collaborationId  String
  channelId        String
  title            String?
  url              String
  contentType      ContentType   @default(VIDEO)
  uploadedAt       DateTime?
  views            Int           @default(0)
  likes            Int           @default(0)
  comments         Int           @default(0)
  shares           Int           @default(0)
  metricsUpdatedAt DateTime?
  notes            String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  channel          Channel       @relation(fields: [channelId], references: [id], onDelete: Cascade)
  collaboration    Collaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  @@index([collaborationId])
  @@index([channelId])
  @@index([contentType])
  @@index([uploadedAt])
  @@map("contents")
  @@schema("influencer")
}

model TreatmentCategory {
  id               String              @id @default(cuid())
  name             String
  nameKo           String?
  slug             String              @unique
  parentId         String?
  manualCategoryId String?
  displayOrder     Int                 @default(0)
  isFeatured       Boolean             @default(false)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  parent           TreatmentCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children         TreatmentCategory[] @relation("CategoryHierarchy")
  treatments       Treatment[]

  @@index([parentId])
  @@index([displayOrder])
  @@map("treatment_categories")
  @@schema("influencer")
}

model Treatment {
  id                    String                   @id @default(cuid())
  name                  String
  nameKo                String?
  category              String?
  manualId              String?                  @unique
  description           String?
  duration              Int?
  priceMin              Decimal?                 @db.Decimal(12, 0)
  priceMax              Decimal?                 @db.Decimal(12, 0)
  recoveryDays          Int?
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  syncedAt              DateTime?
  categoryId            String?
  defaultProgressRounds Int                      @default(2)
  defaultShootingRounds Int                      @default(1)
  isFeatured            Boolean                  @default(false)
  collaborations        CollaborationTreatment[]
  treatmentCategory     TreatmentCategory?       @relation(fields: [categoryId], references: [id])

  @@index([categoryId])
  @@index([category])
  @@index([manualId])
  @@index([isFeatured])
  @@map("treatments")
  @@schema("influencer")
}

model CollaborationTreatment {
  id              String        @id @default(cuid())
  collaborationId String
  treatmentId     String
  notes           String?
  createdAt       DateTime      @default(now())
  collaboration   Collaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
  treatment       Treatment     @relation(fields: [treatmentId], references: [id], onDelete: Cascade)

  @@unique([collaborationId, treatmentId])
  @@index([collaborationId])
  @@index([treatmentId])
  @@map("collaboration_treatments")
  @@schema("influencer")
}

model AIConversation {
  id        String      @id @default(cuid())
  sessionId String
  title     String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  messages  AIMessage[]

  @@index([sessionId])
  @@map("ai_conversations")
  @@schema("influencer")
}

model AIMessage {
  id             String         @id @default(cuid())
  conversationId String
  role           MessageRole
  content        String
  toolCalls      Json?
  toolResults    Json?
  createdAt      DateTime       @default(now())
  conversation   AIConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@map("ai_messages")
  @@schema("influencer")
}

enum InfluencerTier {
  VIP
  GOLD
  SILVER
  BRONZE

  @@schema("influencer")
}

enum Platform {
  YOUTUBE
  INSTAGRAM
  TIKTOK
  BLOG_NAVER
  BLOG_OTHER
  FACEBOOK
  TWITTER
  OTHER

  @@schema("influencer")
}

enum CampaignType {
  COLLABORATION
  ADVERTISEMENT
  EVENT
  REVIEW
  OTHER

  @@schema("influencer")
}

enum CampaignStatus {
  PLANNING
  IN_PROGRESS
  COMPLETED
  CANCELLED

  @@schema("influencer")
}

enum FeeType {
  FIXED
  PER_CONTENT
  REVENUE_SHARE
  BARTER

  @@schema("influencer")
}

enum CollaborationStatus {
  CONTACTED
  NEGOTIATING
  CONFIRMED
  SHOOTING_DONE
  PROGRESS_DONE
  UPLOADED
  COMPLETED
  CANCELLED

  @@schema("influencer")
}

enum ScheduleType {
  SHOOTING
  PROGRESS
  UPLOAD
  MEETING
  REVIEW
  OTHER

  @@schema("influencer")
}

enum ScheduleStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED

  @@schema("influencer")
}

enum ContentType {
  VIDEO
  SHORTS
  IMAGE
  BLOG
  STORY
  OTHER

  @@schema("influencer")
}

enum MessageRole {
  USER
  ASSISTANT
  SYSTEM
  TOOL

  @@schema("influencer")
}
